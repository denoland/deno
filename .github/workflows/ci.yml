# THIS FILE IS AUTOGENERATED USING ./tools/get_workflow.yml
{
  "name": "ci",
  "on": [
    "pull_request"
  ],
  "jobs": {
    "build_linux_release": {
      "name": "build / linux / release",
      "runs-on": "${{ github.repository == 'denoland/deno' && 'ubuntu-latest-xl' || 'ubuntu-18.04' }}",
      "timeout-minutes": 60,
      "env": {
        "CARGO_INCREMENTAL": "0",
        "RUST_BACKTRACE": "full",
        "CARGO_TERM_COLOR": "always"
      },
      "steps": [
        {
          "name": "Configure git",
          "run": "git config --global core.symlinks true"
        },
        {
          "name": "Checkout repository",
          "uses": "actions/checkout@v2",
          "with": {
            "fetch-depth": 5,
            "submodules": true
          }
        },
        {
          "name": "Configure canary",
          "if": "!startsWith(github.ref, 'refs/tags/')",
          "shell": "bash",
          "run": "echo 'DENO_CANARY=true' >> $GITHUB_ENV"
        },
        {
          "name": "Build cache",
          "uses": "actions/cache@v2",
          "with": {
            "path": "~/.cargo/registry\n~/.cargo/git\n.cargo_home\ntarget/*/.*\ntarget/*/build\ntarget/*/deps",
            "key": "linux-release-${{ hashFiles('Cargo.lock') }}",
            "restore-keys": "linux-release-"
          }
        },
        {
          "name": "Setup Rust",
          "uses": "actions-rs/toolchain@v1",
          "with": {
            "default": true,
            "override": true,
            "toolchain": "1.50.0"
          }
        },
        {
          "name": "Build release",
          "uses": "actions-rs/cargo@v1",
          "with": {
            "use-cross": false,
            "command": "build",
            "args": "--locked --all-targets --release"
          }
        },
        {
          "name": "Upload build artifact",
          "uses": "actions/upload-artifact@v2",
          "with": {
            "name": "build-linux-release",
            "path": "target/release/deno\ntarget/release/denort"
          }
        }
      ]
    },
    "build_linux_debug": {
      "name": "build / linux / debug",
      "runs-on": "${{ github.repository == 'denoland/deno' && 'ubuntu-latest-xl' || 'ubuntu-18.04' }}",
      "timeout-minutes": 60,
      "env": {
        "CARGO_INCREMENTAL": "0",
        "RUST_BACKTRACE": "full",
        "CARGO_TERM_COLOR": "always"
      },
      "steps": [
        {
          "name": "Configure git",
          "run": "git config --global core.symlinks true"
        },
        {
          "name": "Checkout repository",
          "uses": "actions/checkout@v2",
          "with": {
            "fetch-depth": 5,
            "submodules": true
          }
        },
        {
          "name": "Configure canary",
          "if": "!startsWith(github.ref, 'refs/tags/')",
          "shell": "bash",
          "run": "echo 'DENO_CANARY=true' >> $GITHUB_ENV"
        },
        {
          "name": "Build cache",
          "uses": "actions/cache@v2",
          "with": {
            "path": "~/.cargo/registry\n~/.cargo/git\n.cargo_home\ntarget/*/.*\ntarget/*/build\ntarget/*/deps",
            "key": "linux-debug-${{ hashFiles('Cargo.lock') }}",
            "restore-keys": "linux-debug-"
          }
        },
        {
          "name": "Setup Rust",
          "uses": "actions-rs/toolchain@v1",
          "with": {
            "default": true,
            "override": true,
            "toolchain": "1.50.0"
          }
        },
        {
          "name": "Build debug",
          "uses": "actions-rs/cargo@v1",
          "with": {
            "use-cross": false,
            "command": "build",
            "args": "--locked --all-targets "
          }
        },
        {
          "name": "Upload build artifact",
          "uses": "actions/upload-artifact@v2",
          "with": {
            "name": "build-linux-debug",
            "path": "target/debug/deno\ntarget/debug/denort"
          }
        }
      ]
    },
    "build_macos_release": {
      "name": "build / macos / release",
      "runs-on": "macos-10.15",
      "timeout-minutes": 60,
      "env": {
        "CARGO_INCREMENTAL": "0",
        "RUST_BACKTRACE": "full",
        "CARGO_TERM_COLOR": "always"
      },
      "steps": [
        {
          "name": "Configure git",
          "run": "git config --global core.symlinks true"
        },
        {
          "name": "Checkout repository",
          "uses": "actions/checkout@v2",
          "with": {
            "fetch-depth": 5,
            "submodules": true
          }
        },
        {
          "name": "Configure canary",
          "if": "!startsWith(github.ref, 'refs/tags/')",
          "shell": "bash",
          "run": "echo 'DENO_CANARY=true' >> $GITHUB_ENV"
        },
        {
          "name": "Build cache",
          "uses": "actions/cache@v2",
          "with": {
            "path": "~/.cargo/registry\n~/.cargo/git\n.cargo_home\ntarget/*/.*\ntarget/*/build\ntarget/*/deps",
            "key": "macos-release-${{ hashFiles('Cargo.lock') }}",
            "restore-keys": "macos-release-"
          }
        },
        {
          "name": "Setup Rust",
          "uses": "actions-rs/toolchain@v1",
          "with": {
            "default": true,
            "override": true,
            "toolchain": "1.50.0"
          }
        },
        {
          "name": "Build release",
          "uses": "actions-rs/cargo@v1",
          "with": {
            "use-cross": false,
            "command": "build",
            "args": "--locked --all-targets --release"
          }
        },
        {
          "name": "Upload build artifact",
          "uses": "actions/upload-artifact@v2",
          "with": {
            "name": "build-macos-release",
            "path": "target/release/deno\ntarget/release/denort"
          }
        }
      ]
    },
    "build_windows_release": {
      "name": "build / windows / release",
      "runs-on": "windows-2019",
      "timeout-minutes": 60,
      "env": {
        "CARGO_INCREMENTAL": "0",
        "RUST_BACKTRACE": "full",
        "CARGO_TERM_COLOR": "always"
      },
      "steps": [
        {
          "name": "Configure git",
          "run": "git config --global core.symlinks true"
        },
        {
          "name": "Checkout repository",
          "uses": "actions/checkout@v2",
          "with": {
            "fetch-depth": 5,
            "submodules": true
          }
        },
        {
          "name": "Configure canary",
          "if": "!startsWith(github.ref, 'refs/tags/')",
          "shell": "bash",
          "run": "echo 'DENO_CANARY=true' >> $GITHUB_ENV"
        },
        {
          "name": "Build cache",
          "uses": "actions/cache@v2",
          "with": {
            "path": "~/.cargo/registry\n~/.cargo/git\n.cargo_home\ntarget/*/.*\ntarget/*/build\ntarget/*/deps",
            "key": "windows-release-${{ hashFiles('Cargo.lock') }}",
            "restore-keys": "windows-release-"
          }
        },
        {
          "name": "Setup Rust",
          "uses": "actions-rs/toolchain@v1",
          "with": {
            "default": true,
            "override": true,
            "toolchain": "1.50.0"
          }
        },
        {
          "name": "Build release",
          "uses": "actions-rs/cargo@v1",
          "with": {
            "use-cross": false,
            "command": "build",
            "args": "--locked --all-targets --release"
          }
        },
        {
          "name": "Upload build artifact",
          "uses": "actions/upload-artifact@v2",
          "with": {
            "name": "build-windows-release",
            "path": "target/release/deno.exe\ntarget/release/denort.exe"
          }
        }
      ]
    }
  }
}