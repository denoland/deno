{
  "tempDir": true,
  "tests": {
    "remove_cleans_node_modules": {
      "steps": [
        {
          // initial install with two packages
          "args": "install",
          "output": "[WILDCARD]"
        },
        {
          // verify both packages exist in node_modules/.deno
          "args": [
            "eval",
            "const entries = Array.from(Deno.readDirSync('node_modules/.deno')).filter(e => !e.name.startsWith('.')).map(e => e.name); const hasChalk = entries.some(e => e.includes('chalk@5.0.1')); const hasCowsay = entries.some(e => e.includes('cowsay@1.5.0')); console.log(`chalk: ${hasChalk}, cowsay: ${hasCowsay}`);"
          ],
          "output": "chalk: true, cowsay: true\n"
        },
        {
          // use deno remove to remove cowsay - should clean up node_modules
          "args": "remove cowsay",
          "output": "[WILDCARD]"
        },
        {
          // verify only chalk remains, cowsay is cleaned up
          "args": [
            "eval",
            "const entries = Array.from(Deno.readDirSync('node_modules/.deno')).filter(e => !e.name.startsWith('.')).map(e => e.name); const hasChalk = entries.some(e => e.includes('chalk@5.0.1')); const hasCowsay = entries.some(e => e.includes('cowsay@1.5.0')); console.log(`chalk: ${hasChalk}, cowsay: ${hasCowsay}`);"
          ],
          "output": "chalk: true, cowsay: false\n"
        },
        {
          // verify cowsay symlink is removed from root node_modules
          "args": [
            "eval",
            "try { Deno.statSync('node_modules/cowsay'); console.log('EXISTS'); } catch { console.log('NOT_FOUND'); }"
          ],
          "output": "NOT_FOUND\n"
        }
      ]
    }
  }
}
